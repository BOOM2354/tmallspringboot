<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="boughtPage">
	<script>
		var deleteOrder = false;
		var deleteOrderid = 0;
		$(function(){
			$("a[orderStatus]").click(function(){
				var orderStatus = $(this).attr("orderStatus");
				if('all'==orderStatus){
					$("table[orderStatus]").show();
				}
				else{
					$("table[orderStatus]").hide();
					$("table[orderStatus="+orderStatus+"]").show();        
				}
				 
				$("div.orderType div").removeClass("selectedOrderType");
				$(this).parent("div").addClass("selectedOrderType");
			});
			 
			$("a.deleteOrderLink").click(function(){
				deleteOrderid = $(this).attr("oid");
				deleteOrder = false;
				$("#deleteConfirmModal").modal("show");
			});
			 
			$("button.deleteConfirmButton").click(function(){
				deleteOrder = true;
				$("#deleteConfirmModal").modal('hide');
			});
			 
			$('#deleteConfirmModal').on('hidden.bs.modal', function (e) {
				if(deleteOrder){
					var page="deleteOrder";
					$.post(
						page,
						{"oid":deleteOrderid},
						function(result){
							if("success"==result){
								$("table.orderListItemTable[oid="+deleteOrderid+"]").hide();
							}
							else{
								location.href="login";
							}
						}
					);
				}
			})     
			 
			$(".ask2delivery").click(function(){
				var link = $(this).attr("link");
				$(this).hide();
				page = link;
				$.ajax({
					url: page,
					success: function(result){
						alert("卖家已秒发，刷新当前页面，即可进行确认收货")
					}
				});
			});
		});
	</script>
     
	<div class="boughtDiv">
		<div class="orderType">
			<div class="selectedOrderType"><a th:attr="orderStatus=@{'all'}" href="#">所有订单</a></div>
			<div><a th:attr="orderStatus=@{'waitPay'}" href="#">待付款</a></div>
			<div><a th:attr="orderStatus=@{'waitDelivery'}" href="#">待发货</a></div>
			<div><a th:attr="orderStatus=@{'waitConfirm'}" href="#">待收货</a></div>
			<div><a th:attr="orderStatus=@{'waitReview'}" href="#" class="noRightborder">待评价</a></div>
			<div class="orderTypeLastOne"><a class="noRightborder"> </a></div>
		</div>
		<div style="clear:both"></div>
		<div class="orderListTitle">
			<table class="orderListTitleTable">
				<tr>
					<td>宝贝</td>
					<td width="100px">单价</td>
					<td width="100px">数量</td>
					<td width="120px">实付款</td>
					<td width="100px">交易操作</td>
				</tr>
			</table>
		</div>
		<div class="orderListItem">
			<table class="orderListItemTable" th:each="o : ${os}" th:attr="orderStatus=@{${o.status}}, oid=@{${o.id}}" >
				<tr class="orderListItemFirstTR">
					<td colspan="2">
					<b th:inline="text">[[${#dates.format(o.createDate, 'yyyy-MM-dd HH:mm:ss')}]]</b>
					<span th:inline="text">订单号: [[${o.orderCode}]]</span>
					</td>
					<td colspan="2"><img width="13px" th:attr="src=@{/img/site/orderItemTmall.png}">天猫商场</td>
					<td colspan="1">
						<a class="wangwanglink" href="#">
							<span class="orderItemWangWangGif"></span>
						</a>
					</td>
					<td class="orderItemDeleteTD">
						<a class="deleteOrderLink" th:attr="oid=@{${o.id}}" href="#">
							<span  class="orderListItemDelete glyphicon glyphicon-trash"></span>
						</a>
					</td>
				</tr>
				<tr class="orderItemProductInfoPartTR" th:each="oi, stat : ${o.orderItems}">
					<td class="orderItemProductInfoPartTD"><img width="80" height="80" th:attr="src=@{'/img/productSingle_middle/'+${oi.product.firstProductImage.id}+'.jpg'}"></td>
					<td class="orderItemProductInfoPartTD">
						<div class="orderListItemProductLinkOutDiv">
							<a th:href="@{'/product/'+${oi.product.id}}" th:inline="text">[[${oi.product.name}]]</a>
							<div class="orderListItemProductLinkInnerDiv">
								<img th:attr="src=@{/img/site/creditcard.png}" title="支持信用卡支付">
								<img th:attr="src=@{/img/site/7day.png}" title="消费者保障服务,承诺7天退货">
								<img th:attr="src=@{/img/site/promise.png}" title="消费者保障服务,承诺如实描述">                      
							</div>
						</div>
					</td>
					<td class="orderItemProductInfoPartTD" width="100px">
						<div class="orderListItemProductOriginalPrice" th:inline="text">￥[[${#numbers.formatDecimal(oi.product.originalPrice,0,'COMMA',2,'POINT')}]]</div>
						<div class="orderListItemProductPrice" th:inline="text">￥[[${#numbers.formatDecimal(oi.product.promotePrice,0,'COMMA',2,'POINT')}]]</div>
					</td>
					<td valign="top" th:attr="rowspan=@{${o.orderItems.size()}}" class="orderListItemNumberTD orderItemOrderInfoPartTD" width="100px" th:if="${stat.count==1}">
						<span class="orderListItemNumber" th:inline="text">[[${o.totalNumber}]]</span>
					</td>
					<td valign="top" th:attr="rowspan=@{${o.orderItems.size()}}" width="120px" class="orderListItemProductRealPriceTD orderItemOrderInfoPartTD" th:if="${stat.count==1}">
						<div class="orderListItemProductRealPrice" th:inline="text">￥[[${#numbers.formatDecimal(o.total,0,'COMMA',2,'POINT')}]]</div>
						<div class="orderListItemPriceWithTransport">(含运费：￥0.00)</div>
					</td>
					<td valign="top" th:attr="rowspan=@{${o.orderItems.size()}}" class="orderListItemButtonTD orderItemOrderInfoPartTD" width="100px" th:if="${stat.count==1}">
						<a th:href="@{'/confirmPay/'+${o.id}}" th:if="${o.status=='waitConfirm'}">
							<button class="orderListItemConfirm">确认收货</button>
						</a>
						<a th:href="@{'/alipay/'+${o.id}+'/'+${o.total}}" th:if="${o.status=='waitPay'}">
							<button class="orderListItemConfirm">付款</button>
						</a>                             
						<span th:if="${o.status=='waitDelivery'}">待发货 <button class="btn btn-info btn-sm ask2delivery">催卖家发货</button></span>
	   			  
						<a th:href="@{'/review/'+${o.id}}" th:if="${o.status=='waitReview'}">
							<button  class="orderListItemReview">评价</button>
						</a>
						<span th:if="${o.status=='finish'}">完成</span>
					</td>                    
				</tr>
			</table>
		</div>
	</div>
</div>
</html>